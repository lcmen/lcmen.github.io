<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>Pattern matching with Ruby - Lucas Mendelowski</title>

    <meta charset="utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport" />
    <meta name="description" content="Pattern matching introduced in Ruby 2.7, allows for matching values against patterns and deconstructing their constituent parts." />
    <meta name="turbo-cache-control">

    <meta property="og:title" content="Pattern matching with Ruby - Lucas Mendelowski" />
    <meta property="og:description" content="Pattern matching introduced in Ruby 2.7, allows for matching values against patterns and deconstructing their constituent parts." />
    <meta property="og:image" content="https://www.mendelowski.com/assets/img/social.png" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:url" content="https://www.mendelowski.com" />
    <meta property="og:site_name" content="Lucas Mendelowski" />

    <meta name="twitter:title" content="Pattern matching with Ruby - Lucas Mendelowski" />
    <meta name="twitter:description" content="Pattern matching introduced in Ruby 2.7, allows for matching values against patterns and deconstructing their constituent parts." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="lmendelowski" />
    <meta name="twitter:site" content="lmendelowski" />
    <meta name="twitter:image" content="https://www.mendelowski.com/assets/img/social.png" />

    <link rel="canonical" href="https://www.mendelowski.com/blog/2023/09/pattern-matching-with-ruby" />
    <link rel="icon" type="image/png" href="/assets/img/favicon.png" />
    <link crossorigin="crossorigin" href="https://fonts.gstatic.com" rel="preconnect" />
    <link crossorigin="crossorigin" href="https://unpkg.com" rel="preconnect" />
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" />
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" /></noscript>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css">
    <link rel="stylesheet" href="/assets/css/main.css" media="screen" data-turbo-track="reload">
    <script src="/assets/js/main.js" data-turbo-track="reload"></script>
    <script src="https://unpkg.com/@hotwired/turbo" defer></script>
  </head>
  <body>
    <div id="main">
      <header id="header" class="container mx-auto" data-turbo-permanent>
  <div class="flex items-center justify-between py-6 lg:py-10">
    <a href="/" class="flex items-center" aria-label="Homepage">
      <img src="/assets/img/logo.svg" width="44" height="36" alt="logo" />
    </a>
    <div class="flex items-center lg:hidden">
      <button id="menu" class="group z-50" aria-label="Mobile menu">
        <svg
          width="24"
          height="15"
          xmlns="http://www.w3.org/2000/svg"
          class="relative z-50 fill-current text-primary transition-transform group-[.active]:fill-white group-[.active]:rotate-90"
        >
          <g fill-rule="evenodd">
            <rect width="24" height="3" />
            <rect y="6" width="24" height="3" />
            <rect y="12" width="24" height="3" />
          </g>
        </svg>
      </button>
      <nav class="pointer-events-none fixed inset-0 z-30 flex bg-black bg-opacity-80 opacity-0 transition-opacity lg:hidden duration-300">
        <div class="ml-auto w-2/3 bg-green p-4 md:w-1/3">
          <ul class="mt-8 flex flex-col">
            <li>
              <a
                href="/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Intro"
              >Intro</a>
            </li>

            <li>
              <a
                href="/blog/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Blog"
              >Blog</a>
            </li>

            <li>
              <a
                href="/til/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Today I Learned"
              >Til</a>
            </li>

            <li>
              <a
                href="/uses/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Uses"
              >Uses</a>
            </li>

            <li>
              <a
                href="/contact/"
                class="mb-3 block px-2 font-body text-lg font-medium text-white"
                aria-label="Contact"
              >Contact</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <div class="hidden lg:block">
      <ul class="flex items-center">
        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Intro"
          >Intro</a>
        </li>

        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/blog/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Blog"
          >Blog</a>
        </li>

        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/til/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Today I Learned"
          >Til</a>
        </li>

        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/uses/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Uses"
          >Uses</a>
        </li>

        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow">
          </div>
          <a
            href="/contact/"
            class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green"
            aria-label="Contact"
          >Contact</a>
        </li>
      </ul>
    </div>
  </div>
</header>


      <div>
        <div class="container mx-auto">
          <article class="mb-8">
  <p class="mb-4">
    
      <span class="inline-block rounded-full bg-secondary px-2 py-1 font-body text-sm text-white">
  #ruby
</span>

    
  </p>
  <h2 class="block font-body text-3xl font-semibold leading-tight text-primary transition-colors">
    Pattern matching with Ruby
  </h2>
  <div class="flex items-center gap-2 py-4 font-body text-grey">
    <p class="font-light">
      September 28, 2023
    </p>
    <span>//</span>
    <p class="font-light">
      3 min read
    </p>
  </div>
  <content class="prose prose max-w-none">
    <p>With version 2.7, Ruby introduced a new language construct to work with data structures called pattern matching.</p>

<p>Pattern matching is a concept borrowed from functional programming. It enables developers to match values based on their structure (shape) and extract their elements at the same time. This powerful addition to the Ruby toolkit opens up new avenues for expressing complex logic in a more natural and elegant way.</p>

<p>In this article we will dive in and unlock the power of pattern matching to make your code easier to understand and reason about.</p>

<p>Your codebase will thank you!</p>

<h2 id="matching-against-array-or-hashes">Matching against array or hashes</h2>

<p>In Ruby, pattern matching can be done using the <code class="language-plaintext highlighter-rouge">in</code> or <code class="language-plaintext highlighter-rouge">=&gt;</code> (only available in Ruby &gt;= 3) operators. For the time being, destructering hashes is limited to those indexed by symbols (strings are not supported).</p>

<p>Below are a couple of examples illustrating the power of this approach:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># assuming api.get returns hashes like:</span>
<span class="c1">#   - { success: true|false, data: Object }</span>
<span class="c1">#   - { error: true, message: String }</span>

<span class="k">case</span> <span class="n">api</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">in</span> <span class="p">{</span> <span class="ss">success: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">data: </span><span class="n">user</span> <span class="p">}</span>
  <span class="nb">p</span> <span class="n">user</span>
<span class="k">in</span> <span class="p">{</span> <span class="ss">success: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">message: </span><span class="n">error</span> <span class="p">}</span>
  <span class="nb">p</span> <span class="n">error</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In this example, we use a <code class="language-plaintext highlighter-rouge">case</code> statement with the <code class="language-plaintext highlighter-rouge">in</code> operator to match different patterns within the returned hash from <code class="language-plaintext highlighter-rouge">api.get</code> method. Depending on the <code class="language-plaintext highlighter-rouge">success</code> field, we extract different values from the result.</p>

<p>If we only need to extract some value from the data (destructure), we can use <code class="language-plaintext highlighter-rouge">=&gt;</code> operator to avoid lengthy <code class="language-plaintext highlighter-rouge">case</code> / <code class="language-plaintext highlighter-rouge">in</code> construction.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">success: </span><span class="kp">true</span> <span class="p">}</span>
<span class="n">result</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">success: </span><span class="p">}</span>
<span class="n">success</span> <span class="c1"># true</span>
</code></pre></div></div>

<p>We can use both constructs to match against arrays as well:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># assuming result is similar to Rack compatible response</span>
<span class="c1"># (e.g. `[200, { "Content-Type": "text/plain" }, ["Hello World"] ]`)</span>

<span class="k">case</span> <span class="n">result</span>
<span class="k">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">body</span><span class="p">]</span>
  <span class="nb">p</span> <span class="n">body</span>
<span class="k">in</span> <span class="p">[</span><span class="mi">302</span><span class="p">,</span> <span class="p">{</span> <span class="no">Location</span><span class="p">:</span> <span class="n">url</span> <span class="p">},</span> <span class="n">_</span><span class="p">]</span>
  <span class="nb">p</span> <span class="n">url</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="matching-multiple-patterns">Matching multiple patterns</h2>

<p>You can also match against multiple patterns within a single block by using the <code class="language-plaintext highlighter-rouge">|</code> operator:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># assuming api.get might return hashes in one of the following schemas:</span>
<span class="c1">#   - { success: true|false, data: Object }</span>
<span class="c1">#   - { error: true, message: String }</span>
<span class="c1">#   - { error: true, data: String }</span>

<span class="k">case</span> <span class="n">api</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">in</span> <span class="p">{</span> <span class="ss">success: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">data: </span><span class="n">user</span> <span class="p">}</span>
  <span class="nb">p</span> <span class="n">user</span>
<span class="k">in</span> <span class="p">{</span> <span class="ss">success: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">data: </span><span class="n">error</span> <span class="p">}</span> <span class="o">|</span> <span class="p">{</span> <span class="ss">error: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">message: </span><span class="n">error</span> <span class="p">}</span>
  <span class="nb">p</span> <span class="n">error</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="guards-in-pattern-matching">Guards in pattern matching</h2>

<p>Matchers can also include additional check that is verified after the value is matched:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># assuming api.get might return hashes in one of the following schemas:</span>
<span class="c1">#   - { status: 200, data: Object }</span>
<span class="c1">#   - { status: 201, data: Object }</span>
<span class="c1">#   - { status: 403, error: String }</span>

<span class="k">case</span> <span class="n">api</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">in</span> <span class="p">{</span> <span class="ss">status: </span><span class="n">status</span><span class="p">,</span> <span class="ss">data: </span><span class="n">user</span> <span class="p">}</span> <span class="k">if</span> <span class="p">(</span><span class="mi">200</span><span class="o">...</span><span class="mi">400</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
  <span class="nb">p</span> <span class="n">user</span>
<span class="k">in</span> <span class="p">{</span> <span class="ss">error: </span><span class="n">error</span> <span class="p">}</span>
  <span class="nb">p</span> <span class="n">error</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="assigning-matched-values-to-variables">Assigning matched values to variables</h2>

<p>To assign the matched value from <code class="language-plaintext highlighter-rouge">case</code> / <code class="language-plaintext highlighter-rouge">in</code> construct to a variable (e.g. for further processing), combine it with the <code class="language-plaintext highlighter-rouge">=&gt;</code> operator:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">api</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">in</span> <span class="p">{</span> <span class="ss">success: </span><span class="kp">true</span><span class="o">|</span><span class="kp">false</span><span class="p">,</span> <span class="ss">data: </span><span class="no">Object</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="n">response</span>
  <span class="nb">p</span> <span class="n">response</span><span class="p">[</span><span class="ss">:data</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This allows you to work with the matched value conveniently by exposing the whole data under variable with the provided name (<code class="language-plaintext highlighter-rouge">response</code> in this case).</p>

<h2 id="matching-the-same-value-across-patterns">Matching the same value across patterns</h2>

<p>To match the same value across different points of comparison, ese the <code class="language-plaintext highlighter-rouge">^</code> (pin operator):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="p">[</span><span class="n">api</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="s1">'active'</span><span class="p">),</span> <span class="n">api</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="s1">'invited'</span><span class="p">)]</span>
<span class="k">in</span> <span class="p">[</span><span class="n">number</span><span class="p">,</span> <span class="o">^</span><span class="n">number</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="s2">"The same number of active users as invited"</span>
<span class="k">else</span>
  <span class="nb">puts</span> <span class="s2">"Number are not the same"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Here, we ensure that the <code class="language-plaintext highlighter-rouge">number</code> in both positions of the array is the same.</p>

<h2 id="ignoring-values">Ignoring values</h2>

<p>Sometimes, you might want to ignore specific values. You can use the underscore (<code class="language-plaintext highlighter-rouge">_</code>) for this purpose:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">api</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="s1">'active'</span><span class="p">)</span>
<span class="k">in</span> <span class="p">[</span><span class="n">_</span><span class="p">,</span> <span class="n">user</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="s2">"A second active user is: </span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="matching-against-classes">Matching against classes</h2>

<p>In Ruby, pattern matching isn’t limited to arrays and hashes. You can also utilize it with your own classes. To make a class available for pattern matching operators, you need to implement two methods:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">deconstruct</code> for array-style matching</li>
  <li><code class="language-plaintext highlighter-rouge">deconstruct_key</code> for hash-style matching</li>
</ul>

<p>These methods allow you to specify how the class instance should be deconstructed when pattern matching is applied.</p>

<p>Here’s an example of a class named <code class="language-plaintext highlighter-rouge">Response</code> that implements these methods to make it pattern-matchable:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Response</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:success</span><span class="p">,</span> <span class="ss">:result</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">deconstruct</span>
    <span class="p">[</span><span class="n">success</span><span class="p">,</span> <span class="n">result</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">deconstruct_key</span>
    <span class="p">{</span> <span class="ss">success: </span><span class="n">success</span><span class="p">,</span> <span class="ss">result: </span><span class="n">result</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In this <code class="language-plaintext highlighter-rouge">Response</code> class, we’ve defined the <code class="language-plaintext highlighter-rouge">deconstruct</code> method, which returns an array, and the <code class="language-plaintext highlighter-rouge">deconstruct_key</code> method, which returns a hash. These methods specify how an instance of the <code class="language-plaintext highlighter-rouge">Response</code> class should be deconstructed when pattern matched using array-style or hash-style patterns.</p>

<p>Let’s try the pattern matching with instances of our <code class="language-plaintext highlighter-rouge">Response</code> class:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">response</span> <span class="o">=</span> <span class="no">Response</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="kp">true</span><span class="p">,</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Jon Snow"</span> <span class="p">})</span>

<span class="k">case</span> <span class="n">response</span>
<span class="k">in</span> <span class="p">[</span><span class="kp">true</span><span class="p">,</span> <span class="n">user</span><span class="p">]</span>
  <span class="nb">p</span> <span class="n">user</span>
<span class="k">end</span>

<span class="k">case</span> <span class="n">response</span>
<span class="k">in</span> <span class="p">{</span> <span class="ss">success: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">result: </span><span class="n">user</span> <span class="p">}</span>
  <span class="nb">p</span> <span class="n">user</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Pattern matching in Ruby is a powerful tool that simplifies data extraction and enhances code clarity. It’s a valuable addition to your Ruby toolkit, enabling you to write cleaner, and more expressive code.</p>

  </content >
</article>

        </div>
      </div>

      <footer id="footer" class="container mx-auto">
  <div class="flex flex-col items-center justify-between border-t border-grey-lighter py-10 sm:flex-row sm:py-12">
    <p class="font-body font-light text-primary">
      &copy; 2025 Lucas Mendelowski
    </p>
    <div class="flex items-center pt-5 gap-5 sm:pt-0">
      
        <a href="https://bsky.app/profile/lucas.mendelowski.com" target="_blank" rel="nofollow noopener noreferrer" target="_blank" aria-label="bluesky">
          <i class="text-4xl text-primary hover:text-secondary transition-colors bx bxl-bluesky"></i>
        </a>
      
        <a href="https://github.com/lcmen" target="_blank" rel="nofollow noopener noreferrer" target="_blank" aria-label="github">
          <i class="text-4xl text-primary hover:text-secondary transition-colors bx bxl-github"></i>
        </a>
      
        <a href="https://www.linkedin.com/in/lucasmendelowski/" target="_blank" rel="nofollow noopener noreferrer" target="_blank" aria-label="linkedin">
          <i class="text-4xl text-primary hover:text-secondary transition-colors bx bxl-linkedin"></i>
        </a>
      
        <a href="https://twitter.com/lmendelowski" target="_blank" rel="nofollow noopener noreferrer" target="_blank" aria-label="twitter">
          <i class="text-4xl text-primary hover:text-secondary transition-colors bx bxl-twitter"></i>
        </a>
      
    </div>
  </div>
</footer>

    </div>
  </body>
</html>
